<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> MyBatis 事务操作中缓存带来的坑 · TanChao的博客</title><meta name="description" content="The longest journey begins with the first step."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://tanchao90.com/atom.xml" title="TanChao的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">所有文章</a></li><li class="nav-list-item"><a href="http://weibo.com/tanchao90" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/tanchao90" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">MyBatis 事务操作中缓存带来的坑</h1><div class="post-info">Aug 25, 2017</div><div class="post-content"><p>记一次 MyBatis 缓存踩坑过程，最后通过跟踪源码定位、解决问题。</p>
<a id="more"></a>
<h2 id="踩坑背景"><a href="#踩坑背景" class="headerlink" title="踩坑背景"></a>踩坑背景</h2><p>我们的项目使用 <a href="http://www.mybatis.org/mybatis-3/" target="_blank" rel="external">MyBatis</a> 作为数据库访问层，并且使用 <a href="https://code.google.com/archive/p/shardbatis/" target="_blank" rel="external">shardbatis</a> 进行分表，分表逻辑通过实现 <code>ShardStrategy</code> 接口中的 <code>getTargetTableName</code> 接口完成。踩坑是在下面的特定情况下发生的：</p>
<ul>
<li>假如有三个分表，分别是 <code>demo_0</code>、<code>demo_1</code>、<code>demo_2</code>，其中包含的满足后面查询条件的数据分别有3条、0条、1条；</li>
<li>通过 <a href="http://www.mybatis.org/generator/" target="_blank" rel="external">MyBatis Generator</a> 生成对应的文件，包括 <code>DemoMapper.xml</code>、<code>DemoMapper.java</code>、<code>Demo.Java</code>、<code>DemoExample.java</code>；</li>
<li>业务处理函数 <code>getDemoList</code> 被 <code>@Transactional</code> 注解，这是一个事务性操作，失败时数据库操作会回滚；</li>
<li><code>getDemoList</code> 函数需要用同样的查询条件查询多张分表，并汇总结果；</li>
<li>查询的 SQL 语句通过 DemoExample 类实例创建。</li>
</ul>
<h2 id="实际表现"><a href="#实际表现" class="headerlink" title="实际表现"></a>实际表现</h2><p>实际的查询结果与 <code>getDemoList</code> 函数查询分表的顺序有关，如下表格所示：</p>
<table>
<thead>
<tr>
<th style="text-align:center">数据表查询顺序</th>
<th style="text-align:center">查询总结果中的记录数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">demo_0、demo_1、demo_2</td>
<td style="text-align:center">9</td>
</tr>
<tr>
<td style="text-align:center">demo_1、demo_0、demo_2</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">demo_2、demo_1、demo_0</td>
<td style="text-align:center">3</td>
</tr>
</tbody>
</table>
<p>通过实际的代码 debug 调试，发现 <code>getDemoList</code> 返回的结果是将一份数据重复了三次，并且都是每次查询时 <code>第一个访问的数据表</code> 中的数据。</p>
<h2 id="问题原因及其解决办法"><a href="#问题原因及其解决办法" class="headerlink" title="问题原因及其解决办法"></a>问题原因及其解决办法</h2><h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><p>通过跟踪代码和 Google，发现问题的原因如下：</p>
<ul>
<li>在使用 MyBatis 的项目中，被 <code>@Transactional</code> 注解的函数中，一个单独的 sqlSession 对象将会被创建和使用，所有数据库操作会共用这个 sqlSession，当事务完成时，这个 sqlSession 会以合适的方式提交或回滚；</li>
<li><code>select</code> 语句默认开启查询缓存，并且不清除缓存，所以使用同一个 sqlSession 多次用相同的条件查询数据库时，只有第一次真实访问数据库，后面的查询都直接读取缓存返回；</li>
</ul>
<p>虽然在项目中增加了分表逻辑，但是因为是采用相同的查询语句及其查询条件，所以在到达分表逻辑之前就已经命中缓存，提前返回，从而导致上面的错误。</p>
<h4 id="flushCache-和-useCache-属性"><a href="#flushCache-和-useCache-属性" class="headerlink" title="flushCache 和 useCache 属性"></a><code>flushCache</code> 和 <code>useCache</code> 属性</h4><p>MyBatis 的一级缓存（local cache），即本地缓存，作用域默认为 Session，所以当 Session flush 或 close 之后，该 Session 中的所有 Cache 就将清空。其中 flush 可在每个 SQL 语句中配置，具体说明如下：</p>
<ul>
<li>当为 <code>select</code> 语句时<ul>
<li><code>flushCache</code> 默认为 false，表示任何时候语句被调用，都不会去清空本地缓存和二级缓存；</li>
<li><code>useCache</code> 默认为 true，表示会将本条语句的结果进行二级缓存；</li>
</ul>
</li>
<li>当为 <code>insert</code>、<code>update</code>、<code>delete</code> 语句时：<ul>
<li><code>flushCache</code> 默认为 true，表示任何时候语句被调用，都会导致本地缓存和二级缓存被清空；</li>
<li><code>useCache</code> 属性在该情况下没有。</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><figcaption><span>默认的 select</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">parameterType</span>=<span class="string">"XX"</span> <span class="attr">flushCache</span>=<span class="string">"false"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    ……</div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p>为了解决这个问题，需要在 <code>DemoMapper.xml</code> 中对应的 SQL 中添加 <code>flushCache=&quot;true&quot;</code> 属性，表示在每次查询前清空缓存，下面几个 sql 都需要添加，因为底层都是通过 select 实现：</p>
<ul>
<li><code>selectByExample</code></li>
<li><code>selectByExampleWithRowbounds</code></li>
<li><code>selectByPrimaryKey</code></li>
<li><code>countByExample</code></li>
</ul>
<p>注：Mapper.xml 文件的配置可参考 <a href="http://www.mybatis.org/mybatis-3/zh/sqlmap-xml.html" target="_blank" rel="external">Mapper XML 文件</a>。</p>
<h2 id="定位问题的过程"><a href="#定位问题的过程" class="headerlink" title="定位问题的过程"></a>定位问题的过程</h2><p>本文中用到的 MyBatis 版本是 <code>mybatis-3.3.0</code>：<code>mybatis-3.3.0-sources.jar</code>。</p>
<h4 id="查询本地缓存之前清除缓存"><a href="#查询本地缓存之前清除缓存" class="headerlink" title="查询本地缓存之前清除缓存"></a>查询本地缓存之前清除缓存</h4><figure class="highlight java"><figcaption><span>/org/apache/ibatis/executor/BaseExecutor.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">  ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">"executing a query"</span>).object(ms.getId());</div><div class="line">  <span class="keyword">if</span> (closed) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">"Executor was closed."</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 配置 flushCache="true" 之后，ms.isFlushCacheRequired() 函数返回 true，将会在这里清除本地缓存</span></div><div class="line">  <span class="keyword">if</span> (queryStack == <span class="number">0</span> &amp;&amp; ms.isFlushCacheRequired()) &#123;</div><div class="line">    clearLocalCache();</div><div class="line">  &#125;</div><div class="line">  List&lt;E&gt; list;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    queryStack++;</div><div class="line">    <span class="comment">// 在这里查询本地缓存，key 由查询语句生成</span></div><div class="line">    list = resultHandler == <span class="keyword">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</div><div class="line">      handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">finally</span> &#123;</div><div class="line">    queryStack--;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (queryStack == <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">for</span> (DeferredLoad deferredLoad : deferredLoads) &#123;</div><div class="line">      deferredLoad.load();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// issue #601</span></div><div class="line">    deferredLoads.clear();</div><div class="line">    <span class="keyword">if</span> (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) &#123;</div><div class="line">      <span class="comment">// issue #482</span></div><div class="line">      clearLocalCache();</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> list;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="缓存查询结果"><a href="#缓存查询结果" class="headerlink" title="缓存查询结果"></a>缓存查询结果</h4><figure class="highlight java"><figcaption><span>/org/apache/ibatis/executor/BaseExecutor.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">  List&lt;E&gt; list;</div><div class="line">  localCache.putObject(key, EXECUTION_PLACEHOLDER);</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</div><div class="line">  &#125; <span class="keyword">finally</span> &#123;</div><div class="line">    localCache.removeObject(key);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 将查询结果添加到本地缓存</span></div><div class="line">  localCache.putObject(key, list);</div><div class="line">  <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) &#123;</div><div class="line">    localOutputParameterCache.putObject(key, parameter);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> list;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="根据查询语句生成-cacheKey"><a href="#根据查询语句生成-cacheKey" class="headerlink" title="根据查询语句生成 cacheKey"></a>根据查询语句生成 cacheKey</h4><figure class="highlight java"><figcaption><span>/org/apache/ibatis/executor/BaseExecutor.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> CacheKey <span class="title">createCacheKey</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (closed) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">"Executor was closed."</span>);</div><div class="line">  &#125;</div><div class="line">  CacheKey cacheKey = <span class="keyword">new</span> CacheKey();</div><div class="line">  cacheKey.update(ms.getId());</div><div class="line">  cacheKey.update(Integer.valueOf(rowBounds.getOffset()));</div><div class="line">  cacheKey.update(Integer.valueOf(rowBounds.getLimit()));</div><div class="line">  cacheKey.update(boundSql.getSql());</div><div class="line">  List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</div><div class="line">  TypeHandlerRegistry typeHandlerRegistry = ms.getConfiguration().getTypeHandlerRegistry();</div><div class="line">  <span class="comment">// mimic DefaultParameterHandler logic</span></div><div class="line">  <span class="comment">// 依此遍历查询参数，将每个参数对应的值拼接到 cacheKey 中</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterMappings.size(); i++) &#123;</div><div class="line">    ParameterMapping parameterMapping = parameterMappings.get(i);</div><div class="line">    <span class="keyword">if</span> (parameterMapping.getMode() != ParameterMode.OUT) &#123;</div><div class="line">      Object value;</div><div class="line">      String propertyName = parameterMapping.getProperty();</div><div class="line">      <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</div><div class="line">        value = boundSql.getAdditionalParameter(propertyName);</div><div class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parameterObject == <span class="keyword">null</span>) &#123;</div><div class="line">        value = <span class="keyword">null</span>;</div><div class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</div><div class="line">        value = parameterObject;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        MetaObject metaObject = configuration.newMetaObject(parameterObject);</div><div class="line">        value = metaObject.getValue(propertyName);</div><div class="line">      &#125;</div><div class="line">      cacheKey.update(value);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (configuration.getEnvironment() != <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="comment">// issue #176</span></div><div class="line">    cacheKey.update(configuration.getEnvironment().getId());</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> cacheKey;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Example：</strong>如下，就是根据一个 select 语句生成 cacheKey：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">350854748:2813260859:com.demo.dao.mapper.DemoMapper.selectByExample:0:2147483647:select</div><div class="line">    id, uid, start_time, end_time, status, is_deleted</div><div class="line">    from demo</div><div class="line">    WHERE (  uid = ? and end_time &gt; ? and status = ? and is_deleted = ? ):2:Wed Aug 16 13:32:01 CST 2017:1:false:SqlSessionFactoryBean</div></pre></td></tr></table></figure></p>
<h4 id="Session-管理"><a href="#Session-管理" class="headerlink" title="Session 管理"></a>Session 管理</h4><figure class="highlight java"><figcaption><span>/org/mybatis/spring/SqlSessionTemplate.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">   * Proxy needed to route MyBatis method calls to the proper SqlSession got</div><div class="line">   * from Spring's Transaction Manager</div><div class="line">   * It also unwraps exceptions thrown by &#123;<span class="doctag">@code</span> Method#invoke(Object, Object...)&#125; to</div><div class="line">   * pass a &#123;<span class="doctag">@code</span> PersistenceException&#125; to the &#123;<span class="doctag">@code</span> PersistenceExceptionTranslator&#125;.</div><div class="line">   */</div><div class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionInterceptor</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">      SqlSession sqlSession = getSqlSession(</div><div class="line">          SqlSessionTemplate.<span class="keyword">this</span>.sqlSessionFactory,</div><div class="line">          SqlSessionTemplate.<span class="keyword">this</span>.executorType,</div><div class="line">          SqlSessionTemplate.<span class="keyword">this</span>.exceptionTranslator);</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        Object result = method.invoke(sqlSession, args);</div><div class="line">        <span class="comment">// 对于非事务性 session，会直接调用 commit</span></div><div class="line">        <span class="keyword">if</span> (!isSqlSessionTransactional(sqlSession, SqlSessionTemplate.<span class="keyword">this</span>.sqlSessionFactory)) &#123;</div><div class="line">          <span class="comment">// force commit even on non-dirty sessions because some databases require</span></div><div class="line">          <span class="comment">// a commit/rollback before calling close()</span></div><div class="line">          <span class="comment">// 在 commit 中，会清除本地缓存</span></div><div class="line">          sqlSession.commit(<span class="keyword">true</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">      &#125; <span class="keyword">catch</span> (Throwable t) &#123;</div><div class="line">        Throwable unwrapped = unwrapThrowable(t);</div><div class="line">        <span class="keyword">if</span> (SqlSessionTemplate.<span class="keyword">this</span>.exceptionTranslator != <span class="keyword">null</span> &amp;&amp; unwrapped <span class="keyword">instanceof</span> PersistenceException) &#123;</div><div class="line">          <span class="comment">// release the connection to avoid a deadlock if the translator is no loaded. See issue #22</span></div><div class="line">          closeSqlSession(sqlSession, SqlSessionTemplate.<span class="keyword">this</span>.sqlSessionFactory);</div><div class="line">          sqlSession = <span class="keyword">null</span>;</div><div class="line">          Throwable translated = SqlSessionTemplate.<span class="keyword">this</span>.exceptionTranslator.translateExceptionIfPossible((PersistenceException) unwrapped);</div><div class="line">          <span class="keyword">if</span> (translated != <span class="keyword">null</span>) &#123;</div><div class="line">            unwrapped = translated;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">throw</span> unwrapped;</div><div class="line">      &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">if</span> (sqlSession != <span class="keyword">null</span>) &#123;</div><div class="line">          <span class="comment">// 对于事务性 session，closeSqlSession 时只会 holder.released()</span></div><div class="line">          closeSqlSession(sqlSession, SqlSessionTemplate.<span class="keyword">this</span>.sqlSessionFactory);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="flushCache-所在的-Java-对象"><a href="#flushCache-所在的-Java-对象" class="headerlink" title="flushCache 所在的 Java 对象"></a>flushCache 所在的 Java 对象</h4><figure class="highlight java"><figcaption><span>/org/apache/ibatis/mapping/MappedStatement.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MappedStatement</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flushCacheRequired;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="http://blog.csdn.net/ssssny/article/details/52248960" target="_blank" rel="external">MyBatis 的 flushCache 和 useCache 的使用</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/python-env/" class="prev">PREV</a><a href="/mybatis/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'tanchao90';
var disqus_identifier = 'mybatis-cache-pit/';
var disqus_title = 'MyBatis 事务操作中缓存带来的坑';
var disqus_url = 'http://tanchao90.com/mybatis-cache-pit/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//tanchao90.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://tanchao90.com">TanChao</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80568471-1",'auto');ga('send','pageview');</script></body></html>