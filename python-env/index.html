<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Python 总结 —— Python 版本管理 · TanChao的博客</title><meta name="description" content="The longest journey begins with the first step."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/logo.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://tanchao90.com/atom.xml" title="TanChao的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">所有文章</a></li><li class="nav-list-item"><a href="http://weibo.com/tanchao90" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/tanchao90" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Python 总结 —— Python 版本管理</h1><div class="post-info">Oct 6, 2017</div><div class="post-content"><p>如何在一个系统中维护多个版本的 Python？</p>
<ul>
<li>pyenv</li>
<li>virtualenv</li>
</ul>
<a id="more"></a>
<p>目录：</p>
<ul>
<li><a href="#Python-版本管理">Python 版本管理</a></li>
<li><a href="#pyenv">pyenv</a></li>
<li><a href="#pyenv-virtualenv">pyenv-virtualenv</a></li>
<li><a href="#pip">pip</a></li>
<li><a href="#References">References</a></li>
</ul>
<h2 id="Python-版本管理"><a href="#Python-版本管理" class="headerlink" title="Python-版本管理"></a>Python-版本管理</h2><p>在一个系统中维护多个版本的 Python。</p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>A 项目使用 Python 2.7；B 项目使用 Python 3.5；</li>
<li>A、B 项目都使用 Python 2.7，但是使用的库不相同；</li>
<li>每个项目可保持独立的 Python 版本及其依赖库，保证 Python 环境独立、干净；</li>
</ul>
<h4 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h4><ul>
<li><a href="https://github.com/pypa/virtualenv" target="_blank" rel="external">virtualenv</a> ☆ ☆ ☆<ul>
<li>A tool for creating isolated ‘virtual’ python environments.</li>
</ul>
</li>
<li><a href="https://github.com/yyuu/pyenv" target="_blank" rel="external">pyenv</a> ☆ ☆ ☆ ☆ ☆  <ul>
<li>Simple Python Version Management.</li>
<li>pyenv lets you easily switch between multiple versions of Python.</li>
<li><a href="https://github.com/yyuu/pyenv/wiki/Common-build-problems" target="_blank" rel="external">Common build problems</a></li>
</ul>
</li>
<li><a href="https://github.com/yyuu/pyenv-virtualenv" target="_blank" rel="external">pyenv-virtualenv</a> ☆ ☆ ☆ ☆ ☆    <ul>
<li>pyenv-virtualenv is a pyenv plugin that provides features to manage virtualenvs and conda environments for Python on UNIX-like systems.</li>
</ul>
</li>
<li><a href="https://code.csdn.net/gsls200808/chinese-opensource-mirror-site/tree/master" target="_blank" rel="external">国内开源镜像站点汇总</a></li>
<li><a href="http://mirrors.sohu.com/python/" target="_blank" rel="external">搜狐镜像</a> 内含各个 Python 版本的压缩包</li>
</ul>
<h4 id="个人建议"><a href="#个人建议" class="headerlink" title="个人建议"></a>个人建议</h4><ul>
<li>每个独立的 Python 项目创建一个独立的 Python 环境；</li>
<li>使用 <code>pyenv</code> + <code>pyenv-virtualenv</code> 管理 Python 环境；</li>
</ul>
<h4 id="pyenv-和-pyenv-virtualenv-区别"><a href="#pyenv-和-pyenv-virtualenv-区别" class="headerlink" title="pyenv 和 pyenv-virtualenv 区别"></a>pyenv 和 pyenv-virtualenv 区别</h4><ul>
<li>pyenv-virtualenv 是 pyenv 的插件；</li>
<li>pyenv 安装 Python 时，每个 Python 版本只能安装一份，和官方版本一一对应，如 2.7.14；</li>
<li>pyenv-virtualenv 可以基于官方版本虚拟出任意数量的版本，更加灵活，如基于 2.7.14 虚拟出 <code>app-server-2.7.14</code>、<code>webapp-2.7.14</code> 等；</li>
</ul>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li><code>pyenv install version</code> 安装，version 为对应的 Python 版本号，如 2.7.9；</li>
<li><code>pyenv virtualenv 3.5.2 webapp-3.5.2</code> 以 3.5.2 版本创建虚拟环境；</li>
<li><code>pyenv uninstall version</code> 删除 version 版本的 Python；</li>
<li><code>pyenv commands</code> 列出所有命令；</li>
<li><code>pyenv versions</code> 查看 pyenv 当前可检测到的所有版本，处于激活状态的版本前以 * 标示；</li>
<li><code>pyenv local 2.7.9</code> 设置局部版本</li>
<li><code>pyenv which python</code> 查看当前 python 命令的路径；</li>
<li><code>pyenv which pip</code> 查看当前 pip 命令的路径；</li>
</ul>
<h2 id="pyenv"><a href="#pyenv" class="headerlink" title="pyenv"></a>pyenv</h2><p><a href="https://github.com/pyenv/pyenv" target="_blank" rel="external">pyenv 官方文档</a></p>
<h4 id="Ubuntu-安装"><a href="#Ubuntu-安装" class="headerlink" title="Ubuntu 安装"></a>Ubuntu 安装</h4><ul>
<li><a href="https://github.com/pyenv/pyenv#installation" target="_blank" rel="external">Installation</a> 官方安装文档</li>
<li><code>git clone https://github.com/pyenv/pyenv.git ~/.pyenv</code> clone pyenv 代码到本地；</li>
<li><code>echo &#39;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&#39; &gt;&gt; ~/.bashrc</code> 定义环境变量 <code>PYENV_ROOT</code></li>
<li><code>echo &#39;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&#39; &gt;&gt; ~/.bashrc</code> 将 <code>PYENV_ROOT</code> 添加到 <code>$PATH</code> 路径中</li>
<li><code>echo -e &#39;if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then\n  eval &quot;$(pyenv init -)&quot;\nfi&#39; &gt;&gt; ~/.bashrc</code> 将 <code>pyenv init</code> 命令添加到 shell 中</li>
<li><code>exec &quot;$SHELL&quot;</code> 重启 shell，使配置生效</li>
</ul>
<p>上述 <code>echo</code> 的三步相当于直接修改 <code>~/.bashrc</code> 文件末尾添加下面的内容，后面的 pyenv-virtualenv 也类似：</p>
<figure class="highlight plain"><figcaption><span>~/.bashrc</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">export PYENV_ROOT=&quot;$HOME/.pyenv&quot;</div><div class="line">export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;</div><div class="line">if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then</div><div class="line">  eval &quot;$(pyenv init -)&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<p><strong>注：</strong>其中 <code>~/.bashrc</code> 文件根据系统进行替换，例如：</p>
<ul>
<li>Zsh note: <code>~/.zshenv</code></li>
<li>Ubuntu and Fedora note: <code>~/.bashrc</code></li>
</ul>
<h4 id="Mac-安装"><a href="#Mac-安装" class="headerlink" title="Mac 安装"></a>Mac 安装</h4><ul>
<li>方法1：<ul>
<li><code>brew install pyenv</code></li>
<li>在 <code>~/.bashrc</code> 中添加上述代码片段</li>
</ul>
</li>
<li>方法2：同 Ubuntu 安装</li>
</ul>
<h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><ul>
<li><a href="https://github.com/pyenv/pyenv#uninstalling-pyenv" target="_blank" rel="external">Uninstalling pyenv</a> 官方卸载文档</li>
</ul>
<h4 id="管理不同版本的-Python"><a href="#管理不同版本的-Python" class="headerlink" title="管理不同版本的 Python"></a>管理不同版本的 Python</h4><p><strong>注：</strong>使用 pyenv 安装命令之前还需要安装相关依赖库，详见 <a href="https://github.com/pyenv/pyenv/wiki/Common-build-problems" target="_blank" rel="external">Common build problems</a>，Ubuntu/Debian 需要执行下面的命令：</p>
<p><code>sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev \
libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev \
xz-utils tk-dev</code></p>
<p>安装需要的 Python 版本，安装之后的 Python 在 <code>~/.pyenv/versions</code> 目录下：</p>
<ul>
<li><code>pyenv install version</code> 安装，version 为对应的 Python 版本号，如 2.7.9</li>
<li><code>pyenv uninstall version</code> 删除 version 版本的 Python</li>
</ul>
<p><strong>注：</strong>阿里云通过上面命令安装的时候，一直无法从官网下载到 Python 安装包，最后谷歌找到下面的办法，还算好使：</p>
<ul>
<li><code>cd ~/.pyenv/cache</code> 进入 pyenv 缓存目录，没有 cache 目录时创建一个</li>
<li><code>wget http://mirrors.sohu.com/python/3.6.2/Python-3.6.2.tar.xz</code> 手动从 <a href="http://mirrors.sohu.com/python/" target="_blank" rel="external">搜狐镜像</a> 下载一个 Python 安装包</li>
<li><code>pyenv install 3.6.2</code> 使用 pyenv 安装，因为缓存中已经有了安装包，因此无需再去官网下载</li>
</ul>
<h4 id="不同级别的版本控制"><a href="#不同级别的版本控制" class="headerlink" title="不同级别的版本控制"></a>不同级别的版本控制</h4><p>pyenv 版本控制分下面三个级别，优先级依此增大：</p>
<ul>
<li><code>global</code> 配置全局 Python 版本，配置内容在 <code>~/.pyenv/version</code> 文件中<ul>
<li><code>pyenv global 2.7.9</code> 设置全局版本，取消只能通过删除上述配置文件完成</li>
</ul>
</li>
<li><code>local</code> 设置局部 Python 版本，配置内容在当前目录的 <code>.python-version</code> 文件中<ul>
<li><code>pyenv local 2.7.9</code> 设置局部版本</li>
<li><code>pyenv local --unset</code> 取消局部版本设置</li>
</ul>
</li>
<li><code>shell</code> 设置当前 shell 中的 Python 版本，参数存储在当前 shell 的 <code>PYENV_VERSION</code> 环境变量中<ul>
<li><code>pyenv shell 2.7.9</code></li>
<li><code>pyenv shell --unset</code></li>
</ul>
</li>
</ul>
<h4 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li><code>pyenv commands</code> 列出所有命令；</li>
<li><code>pyenv versions</code> 查看 pyenv 当前可检测到的所有版本，处于激活状态的版本前以 * 标示；</li>
<li><code>pyenv version</code> 查看当前处于激活状态的版本，括号中内容表示这个版本是由哪条途径激活的；</li>
<li><code>pyenv rehash</code> 为所有已安装的可执行文件（如：<code>~/.pyenv/versions/*/bin/*</code>）创建 shims，每当增删了 Python 版本或带有可执行文件的包（如 pip）以后，都应该执行一次本命令；</li>
<li><code>pyenv which python</code> 查看当前 python 命令的路径</li>
<li><code>pyenv which pip</code> 查看当前 pip 命令的路径</li>
</ul>
<h2 id="pyenv-virtualenv"><a href="#pyenv-virtualenv" class="headerlink" title="pyenv-virtualenv"></a>pyenv-virtualenv</h2><p><a href="https://github.com/pyenv/pyenv-virtualenv" target="_blank" rel="external">pyenv-virtualenv 官方文档</a></p>
<h4 id="Ubuntu-安装-1"><a href="#Ubuntu-安装-1" class="headerlink" title="Ubuntu 安装"></a>Ubuntu 安装</h4><ul>
<li><a href="https://github.com/pyenv/pyenv-virtualenv#installation" target="_blank" rel="external">Installation</a> 官方安装文档</li>
<li><code>git clone https://github.com/pyenv/pyenv-virtualenv.git $(pyenv root)/plugins/pyenv-virtualenv</code> clone 仓库到 pyenv 的插件目录；</li>
<li><code>echo &#39;eval &quot;$(pyenv virtualenv-init -)&quot;&#39; &gt;&gt; ~/.bashrc</code> 添加 <code>pyenv virtualenv-init</code> 到 shell，自动激活插件；</li>
<li><code>exec &quot;$SHELL&quot;</code> 重启 shell，使配置生效；</li>
</ul>
<h4 id="Mac-安装-1"><a href="#Mac-安装-1" class="headerlink" title="Mac 安装"></a>Mac 安装</h4><ul>
<li>方法1：<ul>
<li><code>brew install pyenv-virtualenv</code></li>
<li><code>echo &#39;eval &quot;$(pyenv virtualenv-init -)&quot;&#39; &gt;&gt; ~/.bashrc</code></li>
</ul>
</li>
<li>方法2：同 Ubuntu 安装</li>
</ul>
<h4 id="创建虚拟-Python-版本"><a href="#创建虚拟-Python-版本" class="headerlink" title="创建虚拟 Python 版本"></a>创建虚拟 Python 版本</h4><p><code>pyenv virtualenv [version] &lt;virtualenv-name&gt;</code></p>
<ul>
<li><code>[version]</code> 源版本，可选</li>
<li><code>&lt;virtualenv-name&gt;</code> 虚拟环境名称</li>
</ul>
<p>示例：</p>
<ul>
<li><code>pyenv virtualenv 3.5.2 webapp-3.5.2</code> 以 3.5.2 版本创建虚拟环境</li>
<li><code>pyenv virtualenv webapp-2.7.9</code> 只有一个参数的时候，默认从当前 Python 版本创建虚拟环境</li>
</ul>
<p>创建好的虚拟环境也会存在于 <code>~/.pyenv/versions</code> 目录下，如 <code>webapp-3.5.2</code>，但这里只是一个软连接，文件实际存储在源版本根目录下的 <code>envs</code> 目录，如下所示：<br><code>webapp-3.5.2 -&gt; /home/h39/.pyenv/versions/3.5.2/envs/webapp-3.5.2</code></p>
<h4 id="常用命令-2"><a href="#常用命令-2" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li><code>pyenv virtualenvs</code> 列出所有的虚拟环境</li>
<li><code>pyenv uninstall webapp-2.7.9</code> 删除虚拟环境</li>
<li>设置 Python 版本同 <code>pyenv</code> 部分</li>
<li>正确设置 <code>virtualenvs</code> 的情况下，进入或者退出包含 <code>.python-version</code> 的目录时会自动激活/关闭虚拟环境</li>
<li>手动激活/关闭虚拟环境<ul>
<li><code>pyenv activate webapp-2.7.9</code></li>
<li><code>pyenv deactivate</code></li>
</ul>
</li>
</ul>
<h2 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h2><p>pip 是一个 Python 包管理工具，主要是用于安装 PyPI 上的软件包。</p>
<ul>
<li>Github：<a href="https://github.com/pypa/pip" target="_blank" rel="external">pypa/pip</a></li>
<li>Docs：<a href="https://pip.pypa.io/en/stable/" target="_blank" rel="external">pip docs</a></li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><ul>
<li><code>pip install -U pip</code> or <code>pip install --upgrade pip</code> 更新 pip</li>
<li><code>pip install package_name</code> 安装 package_name 包</li>
<li><code>pip --default-timeout=100 install package_name</code> 设置超时时间，避免在网络很差的情况下每次安装都报超时错误</li>
<li><code>pip install package_name.whl</code> 安装本地的 <code>package_name.whl</code> 文件<ul>
<li><a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="external">.whl 文件下载</a></li>
</ul>
</li>
<li><code>pip install --upgrade package_name</code> 升级软件包</li>
<li><code>pip freeze --local | grep -v &#39;^\-e&#39; | cut -d = -f 1  | xargs pip install -U</code> 升级安装的所有软件包</li>
<li><code>pip uninstall package_name</code> 卸载 package_name 包</li>
<li><code>pip show --files package_name</code> 查看安装的具体文件</li>
<li><code>pip list --outdated</code> 查看过期的软件包（可升级的包）</li>
</ul>
<h4 id="批量管理"><a href="#批量管理" class="headerlink" title="批量管理"></a>批量管理</h4><ul>
<li><code>pip freeze &gt; requirements.txt</code> 导出当前环境依赖的软件包</li>
<li><code>pip install -r requirements.txt</code> 在当前环境重建 <code>requirements.txt</code> 中的软件包</li>
</ul>
<h4 id="macOS-pip-安装软件包失败"><a href="#macOS-pip-安装软件包失败" class="headerlink" title="macOS pip 安装软件包失败"></a>macOS pip 安装软件包失败</h4><p><strong>原因：</strong>macOS 引入了 SIP 管理机制，所以旧版本的 pip 创建的文件目录操作被拒绝，包括使用root也是如此。</p>
<p><strong>解决办法：</strong>添加 <code>--user</code> 选项安装到用户包目录</p>
<ul>
<li><code>pip install --user package_name</code></li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://www.v2ex.com/t/256328" target="_blank" rel="external">阿里云 pyenv 无法下载 python</a></li>
<li><a href="http://www.jianshu.com/p/a23448208d9a" target="_blank" rel="external">使用 pyenv 可以在一个系统中安装多个python版本</a></li>
<li><a href="https://unix.stackexchange.com/questions/291737/zipimport-zipimporterror-cant-decompress-data-zlib-not-available" target="_blank" rel="external">zipimport.ZipImportError: can’t decompress data; zlib not available</a><ul>
<li><code>sudo apt-get install zlib1g-dev</code></li>
</ul>
</li>
<li><a href="https://github.com/pyenv/pyenv/issues/25" target="_blank" rel="external">Build failed on Mac OS X 10.9 #25</a><ul>
<li><code>CFLAGS=&quot;-I$(xcrun --show-sdk-path)/usr/include&quot;</code></li>
</ul>
</li>
<li><a href="http://ask.xmodulo.com/install-pip-linux.html" target="_blank" rel="external">《How to install pip on Linux》</a></li>
<li><a href="https://stackoverflow.com/questions/27885397/how-do-i-install-a-python-package-with-a-whl-file" target="_blank" rel="external">How do I install a Python package with a .whl file?</a></li>
<li><a href="https://majing.io/questions/342" target="_blank" rel="external">pip升级更新所有的已安装Python软件包</a></li>
<li><a href="https://stackoverflow.com/questions/7465445/how-to-install-python-modules-without-root-access" target="_blank" rel="external">How to install python modules without root access?</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/gzh/" class="prev">PREV</a><a href="/mybatis-cache-pit/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'tanchao90';
var disqus_identifier = 'python-env/';
var disqus_title = 'Python 总结 —— Python 版本管理';
var disqus_url = 'http://tanchao90.com/python-env/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//tanchao90.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="http://tanchao90.com">TanChao</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80568471-1",'auto');ga('send','pageview');</script></body></html>